\documentclass[english,course]{Notes}

\title{Algebraic stacks}
\subject{Algebraic geometry}
\author{Stefano Maggiolo}
\email{s.maggiolo@gmail.com}
\speaker{Barbara Fantechi}
\date{12}{01}{2009}
\dateend{12}{01}{2009}
\place{SISSA, Trieste}

\newcommand{\defcat}[6]{
  #1 â‰” \left\{
  \begin{array}{l}
    #2 âˆˆ \Obj(#1) \quad â‡” \quad #4\\
    #5 âˆˆ \Mor(#2, #3) \quad â‡” \quad #6
  \end{array}
  \right.
}

\newcommand{\defcatold}[6]{
  #1 â‰” \left\{
  \begin{array}{ll}
    \Obj(#1)\colon & \left\{#2 \middle| #4 \right\}\\
    \Mor(#2, #3)\colon & \left\{#5 \middle| #6 \right\}
  \end{array}
  \right.
}


\begin{document}

\section{Introduzione}\lecture[2 ore]{12}{01}{2009}

\begin{example}
  Siano $V$ uno spazio vettoriale di dimensione finita su un campo algebricamente chiuso $K$ e $r â‰¤ \dim V$; possiamo considerare la grassmanniana dei sottospazi vettoriali di $V$ di dimensione $r$. Questo spazio viene descritto come insieme, ma ha una naturale descrizione come varietÃ  algebrica. Inoltre Ã¨ uno \emph{spazio di moduli fine\/}:
  \begin{itemize}
    \item la varietÃ  d'incidenza $Î“(r, V) â‰” \{(W, x) \mid W âˆˆ G(r, V) âˆ§ v âˆˆ W\}$ Ã¨ un sottofibrato di rango $r$ del fibrato banale $G(r, V) Ã— V$ su $G(r, V)$;
    \item se $X$ Ã¨ uno schema ed $E âŠ† X Ã— V$ Ã¨ un sottofibrato di rango $r$, allora esiste unica $Ï†_E\colon X â†’ G(r, V)$ tale che $E = Ï†_E^â‹†(Î“(r, V))$, cioÃ¨ il diagramma
      \[
      \begin{tikzpicture}
        \def\x{1.5}
        \def\y{-1.2}
        \node (A0_0) at (0*\x, 0*\y) {$E$};
        \node (A0_1) at (1*\x, 0*\y) {$Î“(r, V)$};
        \node (A1_0) at (0*\x, 1*\y) {$X$};
        \node (A1_1) at (1*\x, 1*\y) {$G(r, V)$};
        \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A0_1);
        \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A1_0);
        \path (A0_1) edge [->] node [auto] {$\scriptstyle{}$} (A1_1);
        \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{Ï†_E}$} (A1_1);
      \end{tikzpicture}
      \]
      Ã¨ cartesiano.
  \end{itemize}
\end{example}

\begin{exercise}
  Dimostrare che $G(r, V)$ Ã¨ uno spazio di moduli fine.
\end{exercise}

\begin{remark}
  Come mappa di insiemi, $Ï†_E$ manda $x$ nel punto $[E_x]$ corrispondente al sottospazio vettoriale $E_x âŠ† \{x\} Ã— V$.
\end{remark}
Assumendo sempre $r$ e $V$ fissi, consideriamo un'altra interpretazione. Sia $Î³\colon \Schemes^\opp{} â†’ \Sets$ il funtore controvariante definito in questo modo:
\begin{itemize}
  \item se $X$ Ã¨ uno schema, \[ Î³(X) â‰” \{E â†’ X \mid \text{$E$ sottofibrato di rango $r$ di $X Ã— V$}\}\text{;}\]
  \item se $Ïˆ\colon X â†’ Y$ Ã¨ un morfismo e $E_Y âŠ† Y Ã— V$ Ã¨ un sottofibrato di rango $r$, \[ Î³(Ïˆ)(E_Y) â‰” Ïˆ^â‹†(E_Y) = {(Ïˆ Ã— \id)}^{-1}(E_Y)\text{.}\]
\end{itemize}
Con questo linguaggio, il fatto che $G(r, V)$ Ã¨ uno spazio di moduli fine si esprime dicendo che $Î³$ Ã¨ naturalmente isomorfo al funtore di Yoneda $\ho_{G(r, V)}$. In particolare, a $\id âˆˆ \Aut(G(r, V))$ corrisponde il fibrato $Î“(r, V) â†’ G(r, V)$.

\begin{example}
  Se $X$ Ã¨ una varietÃ  proiettiva (volendo anche liscia), consideriamo $\Pic(X)$, l'insieme dei fibrati lineari su $X$ modulo isomorfismo; $\Pic(X)$ ha una struttura di spazio topologico con, in generale, infinite componenti connesse e ogni componente ha una struttura di varietÃ  algebrica. Inoltre, la struttura di gruppo su $\Pic(X)$ (data dal prodotto tensore) Ã¨ compatibile con la struttura di varietÃ  algebrica. Grazie a questo si dimostra che tutte le componenti connesse sono isomorfe tra loro e quindi si puÃ² considerare solamente la componente connessa dell'identitÃ , $\Pic^0(X)$.
\end{example}

Come costruire il funtore corrispondente a $\Pic^0(X)$, per ottenere una situazione analoga alla precedente?

\begin{definition}
  Sia $X$ una varietÃ  proiettiva liscia; si definisce il funtore controvariante $Ï€\colon \Schemes^\opp{} â†’ \Sets$ mediante:
  \begin{itemize}
    \item se $S$ Ã¨ uno schema, \[ Ï€(S) â‰” \{ L \mid \text{$L$ fibrato lineare su $X Ã— S$}\} / âˆ¼\text{,}\] dove $L âˆ¼ Lâ€²$ sono equivalenti se e solo se esiste $M âˆˆ \Pic(S)$ tale che $Lâ€² â‰… L âŠ— p_S^â‹† M$, dove $p_S\colon X Ã— S â†’ S$ Ã¨ la proiezione\footnote{In tal modo, $Lâ€²_{|X Ã— \{s\}} â‰… L_{|X Ã— \{s\}} âŠ— p_S^â‹† M_{|X Ã— \{s\}} = L_{|X Ã— \{s\}}$, cioÃ¨ si considerano equivalenti due fibrati se si restringono sulla fibra allo stesso oggetto.};
    \item se $Ï†\colon Sâ€² â†’ S$ e $L âˆˆ \Pic(X Ã— S)$, \[ Ï€(Ï†)(L) â‰” Ï†^â‹† L\text{;}\] si puÃ² verificare che questo passa alla relazione d'equivalenza.
  \end{itemize}
\end{definition}

Non dimostreremo il seguente teorema.

\begin{theorem}
  Esiste unica una struttura di varietÃ  algebrica (con infinite componenti connesse) su $\Pic(X)$ ed esiste un fibrato lineare $â„’$, detto \emph{fibrato di PoincarÃ©\/} su $X Ã— \Pic(X)$ tale che $Ï€ â†’ \ho_{\Pic(X)}$ Ã¨ una equivalenza naturale e $â„’$ corrisponde a $\id âˆˆ \Aut(\Pic(X))$; inoltre $â„’$ Ã¨ unico a meno di pullback tramite la proiezione $X Ã— \Pic(X) â†’ \Pic(X)$.
\end{theorem}

Possiamo riformulare il teorema nel modo seguente. Il funtore $Ï€$ Ã¨ rappresentato da una varietÃ  algebrica liscia (con infinite componenti connesse); da questo segue che i $K$-punti di $\Pic(X)$, per definizione in corrispondenza biunivoca con $\Mor(\Spec K, \Pic(X))$, per la rappresentabilitÃ  sono in corrispondenza biunivoca anche con $Ï€(\Spec K)$; questo perÃ² corrisponde a $\Pic(X)$, a priori a meno di pullback di fibrati lineari sul punto, che perÃ² sono solo banali.

PerchÃ© abbiamo la complicazione della tensorizzazione per un pullback? Questo viene dal fatto che due fibrati lineari possono avere diversi modi per essere isomorfi, cioÃ¨ dal fatto che, al contrario dei sottospazi vettoriali di $V$, un fibrato lineare puÃ² avere un gruppo di automorfismi non banali.

La prima apparizione degli stack Ã¨ all'inizio degli anni '60, in francese, con il nome di \emph{champs}, da parte di Giraud, studente di Grothendieck. Ma l'introduzione degli stack come oggetti geometrici Ã¨ dovuta a Deligne e Mumford, alla fine degli anni '60, quando si posero il seguente problema.

\begin{problem}
  Sia $g â‰¥ 2$ un intero; si vuole dare una struttura di varietÃ  algebrica a $M_g$, lo spazio delle curve lisce proiettive di genere $g$ modulo isomorfismo; se possibile come spazio di moduli fine (cioÃ¨ in modo che sia la rappresentazione di un funtore adatto).
\end{problem}

PerchÃ© di genere maggiore o uguale a $2$? PerchÃ© le curve con tali proprietÃ  e di genere $0$ sono solo $â„™^1$, mentre quelle di genere $1$ sono curve ellittiche, studiate da molto tempo e sufficientemente comprese. Il primo approccio a questo problema Ã¨ proprio di Riemann, che dimostrÃ² che per descrivere una curva di genere $g$ sono necessari $3g-3$ parametri che chiamÃ² \emph{moduli}.

\begin{example}
  Le curve di genere $2$ sono tutte iperellittiche; in particolare, se $C$ ha genere $2$ esiste un unica mappa $C â†’ â„™^1$ due a uno, che Ã¨ ramificata in $6$ punti. Viceversa, un tale morfismo ramificato determina una curva di genere $2$. Quindi le curve di genere $2$ sono in corrispondenza con i sottoinsiemi di $6$ punti di $â„™^1$ modulo automorfismi di $â„™^1$; se questi punti fossero ordinati, si potrebbero esaurire gli automorfismi fissando $p_1 = 0$, $p_2 = 1$, $p_3 = âˆž$ e il quoziente avrebbe dimensione $3$. Non essendo ordinati, c'Ã¨ un'altra azione di $S_6$ da tenere in considerazione, che perÃ² non cambia la dimensione del quoziente.
\end{example}

\begin{example}
  In genere $3$, abbiamo le curve iperellittiche (con morfismo su $â„™^1$ ramificato in $8$ punti) e le curve non iperellittiche, che ammettono un unico morfismo su $â„™^2$ (modulo automorfismo di $â„™^2$) su una curva di grado $4$. Le prime hanno $5$ moduli, calcolati nel modo visto prima; di conseguenza le seconde devono averne $6$.
\end{example}

\begin{exercise}
  Dimostrare che le curve di genere $3$ non iperellittiche hanno $6$ moduli.
\end{exercise}

%\begin{proof}[Soluzione.]
%  Le quartiche lisce di $â„™^2$ sono tutte curve di genere $\binom{4-1}{2} = 3$ per la formula del genere. La varietÃ  delle quartiche di $â„™^2$ ha dimensione $\binom{4+2}{4}-1 = 14$; gli automorfismi di $â„™^2$ sono $â„™\GL(3)$, di dimensione $8$; dobbiamo quindi dimostrare che, per la generica quartica $C$, $\Aut(C) / G$ Ã¨ un gruppo finito, dove $G$ Ã¨ il gruppo degli automorfismi di $C$ indotto da $â„™\GL(3)$. 
%\end{proof}

\begin{definition}
  Sia $Î¼_g\colon \Schemes^\opp{} â†’ \Sets$ il funtore definito in questo modo:
  \begin{itemize}
    \item dato uno schema $S$, \[ Î¼_g(S) â‰” \Biggl\{p\colon C â†’ S \Biggm| \parbox{4cm}{$p$ liscio, proiettivo, con $C_s â‰” p^{-1}(s)$ una curva di genere $g$ per ogni $s âˆˆ S$}\Biggr\} \Biggm/ âˆ¼\text{,}\] dove $p âˆ¼ pâ€²$ se esiste un diagramma di questo tipo:
      \[
      \begin{tikzpicture}
        \def\x{1.5}
        \def\y{-1.2}
        \node (A0_0) at (0*\x, 0*\y) {$C$};
        \node (A0_1) at (1*\x, 0*\y) {$Câ€²$};
        \node (A1_0) at (0*\x, 1*\y) {$S$};
        \node (A1_1) at (1*\x, 1*\y) {$Sâ€²$.};
        \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} node [sloped] {$\scriptstyle{\widetilde{\ \ \ }}$} (A0_1);
        \path (A1_0) edge [-,double] node [auto] {$\scriptstyle{}$} (A1_1);
        \path (A0_1) edge [->] node [auto] {$\scriptstyle{pâ€²}$} (A1_1);
        \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{p}$} (A1_0);
      \end{tikzpicture}
      \]
    \item dato un morfismo $Ï†\colon Sâ€² â†’ S$ e una famiglia $p\colon C â†’ S$, \[ Î¼_g(Ï†)(p)\colon C Ã—_S Sâ€² â†’ Sâ€²\text{;}\] questa nuova famiglia mantiene tutte le proprietÃ  richieste.
  \end{itemize}
\end{definition}

In particolare, osserviamo che $Î¼_g(\Spec K) = M_g$.

\begin{problem}
  Esiste una struttura di varietÃ  algebrica su $M_g$ tale che $Î¼_g$ e $\ho_{M_g}$ siano naturalmente equivalenti? In altre parole, $Î¼_g$ Ã¨ rappresentabile?
\end{problem}

La risposta a questa domanda Ã¨ nella seguente proposizione, che verrÃ  dimostrata in seguito.

\begin{proposition}
  Se si definisce $Î¼_g^0$ come $Î¼_g$, con la condizione aggiuntiva che ogni fibra sia una curva rigida (senza automorfismi non banali), allora $Î¼_g^0$ Ã¨ rappresentabile con una varietÃ  liscia $M_g^0$, quasi proiettiva, connessa, di dimensione $3g-3$, a meno che $g = 2$ (perchÃ© tutte le curve di genere $2$, essendo iperellittiche, hanno almeno un'involuzione).
\end{proposition}

\begin{example}
  Per $g = 3$, si considera $U$, l'insieme delle quartiche di $â„™^2$ lisce e rigide (cioÃ¨, i cui soli automorfismi siano indotti da automorfismi di $â„™^2$); allora $U / â„™\GL(3, K)$ Ã¨ $M_3^0$, dato che l'azione di $â„™\GL(3, K)$ Ã¨ senza punti fissi. Com'Ã¨ descritta la curva universale? Sia $Î“_U âŠ† U Ã— â„™^2$ la varietÃ  d'incidenza, con punti $(C, x)$ con $x âˆˆ C$; allora $Î“_U / â„™\GL(3, K) â†’ U / â„™\GL(3, K)$ Ã¨ la famiglia universale, in quanto le sue fibre sono esattamente le fibre di $Î“_U â†’ U$. Se si cerca di inserire anche le quartiche non rigide, nel quozientare si incontrano problemi a causa degli stabilizzatori non banali.
\end{example}

Come si dimostra che un funtore non Ã¨ rappresentabile? Vediamo un'esempio di dimostrazione per il funtore $Î¼_g$.

\begin{proposition}
  Il funtore $Î¼_g$ non Ã¨ rappresentabile.
\end{proposition}

\begin{proof}
  Abbiamo visto che i problemi nascono dalle curve con automorfismi; sia quindi $C_0$ una curva liscia di genere $g$ con un automorfismo $Ï†$ diverso dall'identitÃ . Per fissare le idee, supponiamo $Ï†^2 = \id$ (in realtÃ  Ã¨ sempre possibile trovare una curva con un'involuzione, dato che in ogni genere ci sono curve iperellittiche). Consideriamo $S â‰” ð”¸^1 âˆ– \{0\}$ e la famiglia banale $p\colon C_0 Ã— S â†’ S$; $p$ Ã¨ il pullback di $C_0 â†’ \Spec K$ via l'unica mappa $S â†’ \Spec K$. Se $Î¼_g$ fosse rappresentabile, $p$ dovrebbe necessariamente corrispondere a un morfismo costante $S â†’ M_g$.
  
  Siano ora $Î±\colon S â†’ S$ l'involuzione data da $Î±(t) â‰” -t$ e $Sâ€² â‰” S / Î±$, ancora isomorfo a $S$ con coordinata $s â‰” t^2$. Sia inoltre $Câ€² â‰” (C_0 Ã— S) / (Ï†, Î±)$, dove $(Ï†, Î±)(x,t) = (Ï†(x), -t)$. Quindi il morfismo $p$ induce un morfismo $pâ€²\colon Câ€² â†’ Sâ€²$, con le stesse fibre; in particolare si dimostra che $C_0 Ã— S â‰… Câ€² Ã—_{Sâ€²} S$. Allora tutte le fibre di $pâ€²$ sono isomorfe a $C_0$, perciÃ² se il funtore fosse rappresentabile, $pâ€²$ dovrebbe essere il pullback di una famiglia universale su $M_g$ tramite una mappa costante, e $Câ€²$ dovrebbe essere un prodotto, ma non Ã¨ cosÃ¬.âˆŽ
\end{proof}

In questo caso, si dice che $Câ€² â†’ Sâ€²$ Ã¨ una famiglia \emph{isotriviale}, cioÃ¨ tutte le fibre sono isomorfe ma globalmente non Ã¨ un prodotto. 

\begin{proof}[Dimostrazione alternativa.]
  Sia $T â‰” ð”¸^1$ e consideriamo $Câ€³ â‰” (C_0 Ã— T)/âˆ¼$ dove $(x, t) âˆ¼ (xâ€², tâ€²)$ se sono uguali o $xâ€² = Ï†(x)$ e $\{t, tâ€²\} = \{-1, 1\}$. In altre parole, si identificano le fibre su $-1$ e $1$ e si incollano rovesciate tramite $Ï†$. Si dimostra che $Câ€³$ ha una struttura di varietÃ  algebrica.
  
  Sia ora $Tâ€³ â‰” T / (-1=+1)$; $Tâ€³$ si realizza in $ð”¸^2$ tramite una cubica nodata. Ancora, $Câ€³ â†’ Tâ€³$ Ã¨ una famiglia isotriviale.âˆŽ
\end{proof}

\begin{exercise}
  Dimostrare che $Câ€²$ non Ã¨ un prodotto; si puÃ² assumere che $\Aut(C_0) â‰… \{\id, Î±\}$.
\end{exercise}

Il problema si pone allo stesso modo con i fibrati: tutti i fibrati dello stesso rango sono localmente isomorfi, ma questo non si estende in generale a un isomorfismo globale; per avere uno spazio di moduli fine, ovvero se si vuole considerare un fibrato come un morfismo in un qualche spazio, bisogna anche considerare gli isomorfismi dei morfismi, che nel caso della topologia sono le omotopie.

Cos'Ã¨ andato storto nella definizione di $Î¼_g$? L'idea di uccidere tutti gli isomorfismi considerandoli tutti allo stesso modo. Se $Î¼_g$ fosse naturalmente isomorfo a $\ho_{M_g}$, allora $Î¼_g(S)$ sarebbe in b\^{i}ezione con $\Mor(S, M_g)$; per non dimenticare gli isomorfismi, si deve definire $Î¼_g(S)$ come un oggetto che ricordi sia un insieme di famiglie di curve di genere $g$ con le proprietÃ  richieste, ma anche gli isomorfismi tra queste famiglie. Un oggetto tale Ã¨ un \emph{gruppoide}, cioÃ¨ una categoria in cui ogni morfismo Ã¨ un isomorfismo.

\begin{example}
  Siano $â„­$ e $â„­â€²$ due categorie, $F, G\colon â„­ â†’ â„­â€²$ due funtori covarianti; un funtore manda oggetti in oggetti e morfismi in morfismi; se abbiamo una trasformazione naturale $Î½\colon F â†’ G$, questa manda un oggetto $x âˆˆ â„­$ in un morfismo $Î½(x)\colon F(x) â†’ G(x)$, mentre manda un morfismo $f\colon x â†’ y$ in un diagramma commutativo in $â„­â€²$:
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$F(x)$};
    \node (A0_1) at (1*\x, 0*\y) {$G(x)$};
    \node (A1_0) at (0*\x, 1*\y) {$F(y)$};
    \node (A1_1) at (1*\x, 1*\y) {$G(y)$.};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{Î½(x)}$} (A0_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{Î½(y)}$} (A1_1);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{G(f)}$} (A1_1);
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{F(f)}$} (A1_0);
  \end{tikzpicture}
  \]
  La trasformazione naturale $Î½$ Ã¨ un'equivalenza naturale se $Î½(x)$ Ã¨ un isomorfismo per ogni $x$. In particolare, se $â„­â€²$ Ã¨ un gruppoide, ogni trasformazione naturale $Î½\colon F â†’ G$ Ã¨ un'equivalenza naturale.
\end{example}

\begin{corollary}
  I gruppoidi hanno una struttura di $2$-categoria, in cui ci sono:
  \begin{itemize}
    \item gli oggetti: i gruppoidi stessi;
    \item i morfismi: i funtori covarianti tra gruppoidi;
    \item i $2$-morfismi: le equivalenze naturali;
  \end{itemize}
  i $2$-morfismi, o morfismi tra morfismi, sono tutti invertibili; in particolare, se $X$ e $Y$ sono gruppoidi, allora $\Mor(X, Y)$, la categoria con oggetti i funtori e morfismi le trasformazioni naturali, Ã¨ ancora un gruppoide.
\end{corollary}

L'idea Ã¨ prendere la definizione di schema, scriverla in un modo in cui sia evidente che i morfismi formino un insieme, sostituire i gruppoidi agli insiemi e aggiustare le cose.

\begin{notation}
  Siano $â„­$ e $â„­â€²$ gruppoidi, $F, G\colon â„­ â†’ â„­â€²$ funtori, $Î½$ una equivalenza naturale tra $F$ e $G$ (denotata $Î½\colon F â‡’ G$); questa situazione Ã¨ descritta dal seguente diagramma:
  \[
  \begin{tikzpicture}
    \def\x{1}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$â„­$};
    \node (A0_2) at (2*\x, 0*\y) {$â„­â€²$};
    \path (A0_0) edge [->,bend left=30] node [auto] {$\scriptstyle{F}$} (A0_2);
    \path (A0_0) edge [->,bend right=30] node [auto,swap] {$\scriptstyle{G}$} (A0_2);
    \path (0.98*\x, -0.1*\y) -- (1.02*\x, 0.1*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=-0.4,auto,sloped] {$\scriptstyle{Î½}$};
  \end{tikzpicture}
  \]
  si dice che il diagramma Ã¨ $2$-commutativo.
\end{notation}

\begin{exercise}
  Costruire la composizione
  \[
  \begin{tikzpicture}[baseline]
    \def\x{1}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$â„­$};
    \node (A0_2) at (2*\x, 0*\y) {$â„­â€²$};
    \node (A0_4) at (4*\x, 0*\y) {$â„­â€³$};
    \path (A0_0) edge [->,bend left=30] node [auto] {$\scriptstyle{F_1}$} (A0_2);
    \path (A0_0) edge [->,bend right=30] node [auto,swap] {$\scriptstyle{G_1}$} (A0_2);
    \path (A0_2) edge [->,bend left=30] node [auto] {$\scriptstyle{F_2}$} (A0_4);
    \path (A0_2) edge [->,bend right=30] node [auto,swap] {$\scriptstyle{G_2}$} (A0_4);
    \path (0.98*\x, -0.1*\y) -- (1.02*\x, 0.1*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=-0.4,auto,sloped] {$\scriptstyle{Î½}$};
    \path (2.98*\x, -0.1*\y) -- (3.02*\x, 0.1*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=-0.4,auto,sloped] {$\scriptstyle{Î¼}$};
  \end{tikzpicture}
  \quad \leadsto \quad
  \begin{tikzpicture}[baseline]
    \def\x{1}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$â„­$};
    \node (A0_4) at (4*\x, 0*\y) {$â„­â€³$.};
    \path (A0_0) edge [->,bend left=20] node [auto] {$\scriptstyle{F_2âˆ˜F_1}$} (A0_4);
    \path (A0_0) edge [->,bend right=20] node [auto,swap] {$\scriptstyle{G_2âˆ˜G_1}$} (A0_4);
    \path (1.98*\x, -0.1*\y) -- (2.02*\x, 0.1*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=-0.8,auto,sloped] {$\scriptstyle{Î¼âˆ˜Î½}$};
  \end{tikzpicture}
  \]
\end{exercise}

\begin{exercise}
  Costruire la composizione
  \[
  \begin{tikzpicture}[baseline]
    \def\x{1}
    \def\y{-1}
    \node (A0_0) at (0*\x, 0*\y) {$â„­$};
    \node (A0_2) at (2*\x, 0*\y) {$â„­â€²$};
    \path (A0_0) edge [->,bend left=55] node [auto] {$\scriptstyle{F_1}$} (A0_2);
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A0_2);
    \path (A0_0) edge [->,bend right=55] node [auto,swap] {$\scriptstyle{F_3}$} (A0_2);
    \path (0.99*\x, -0.4*\y) -- (1.01*\x, -0.3*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=-0.8,auto,sloped] {$\scriptstyle{Î½}$};
    \path (0.99*\x, 0.3*\y) -- (1.01*\x, 0.4*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=-0.8,auto,sloped] {$\scriptstyle{Î¼}$};
  \end{tikzpicture}
  \quad \leadsto \quad
  \begin{tikzpicture}[baseline]
    \def\x{1}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$â„­$};
    \node (A0_2) at (2*\x, 0*\y) {$â„­â€²$};
    \path (A0_0) edge [->,bend left=55] node [auto] {$\scriptstyle{F_1}$} (A0_2);
    \path (A0_0) edge [->,bend right=55] node [auto,swap] {$\scriptstyle{F_3}$} (A0_2);
    \path (0.99*\x, -0.1*\y) -- (1.01*\x, 0.1*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=-0.8,auto,sloped] {$\scriptstyle{Î¼âˆ˜Î½}$};
  \end{tikzpicture}
  \]
\end{exercise}

\begin{exercise}
  Costruire la composizione
  \[
  \begin{tikzpicture}[baseline]
    \def\x{1}
    \def\y{-1}
    \node (A0_0) at (0*\x, -1*\y) {$ð”„$};
    \node (A0_2) at (2*\x, -1*\y) {$\mathfrak{B}$};
    \node (A2_0) at (0*\x, 1*\y) {$â„­$};
    \node (A2_2) at (2*\x, 1*\y) {$ð”‡$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A0_2);
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A2_0);
    \path (A0_2) edge [->] node [auto] {$\scriptstyle{}$} (A2_2);
    \path (A2_0) edge [->] node [auto] {$\scriptstyle{}$} (A2_2);
    \path (A0_2) edge [->] node [auto] {$\scriptstyle{}$} (A2_0);
    \path (1.1*\x, -1*\y) -- (0*\x, 0.1*\y) 
      node [pos=0.5,allow upside down,sloped] {$\Longrightarrow$}
      node [pos=0.6,auto,sloped] {$\scriptstyle{Î½}$};
    \path (.9*\x, 1*\y) -- (2*\x, -0.1*\y) 
      node [pos=0.5,allow upside down,sloped] {$\Longrightarrow$}
      node [pos=0.6,auto,sloped] {$\scriptstyle{Î¼}$};
  \end{tikzpicture}
  \quad \leadsto \quad
  \begin{tikzpicture}[baseline]
    \def\x{1}
    \def\y{-1}
    \node (A0_0) at (0*\x, -1*\y) {$ð”„$};
    \node (A0_2) at (2*\x, -1*\y) {$\mathfrak{B}$};
    \node (A2_0) at (0*\x, 1*\y) {$â„­$};
    \node (A2_2) at (2*\x, 1*\y) {$ð”‡$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A0_2);
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A2_0);
    \path (A0_2) edge [->] node [auto] {$\scriptstyle{}$} (A2_2);
    \path (A2_0) edge [->] node [auto] {$\scriptstyle{}$} (A2_2);
    \path (A0_2) -- (A2_0) 
      node [pos=0.5,allow upside down,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{Î¼âˆ˜Î½}$};
  \end{tikzpicture}
  \]
\end{exercise}

\section{Gruppoidi}\lecture[2 ore]{14}{01}{2009}

\begin{definition}
  Sia $X$ uno spazio topologico; il \emph{gruppoide fondamentale\/} Ã¨
  \[\defcat{Ï€_1(X)}{x}{y}{x âˆˆ X}{\left[f\right]}{\left\{\begin{array}{l} f\colon [0,1] â†’ X \text{ continua},\\ f(0) = p, f(1) = q\end{array}\right.}\]
  dove la classe di $f$ Ã¨ presa modulo omotopia relativa a $\{0,1\}$.
\end{definition}

\begin{exercise}
  \mbox{}
  \begin{enumerate}
    \item Il gruppoide fondamentale di $X$ Ã¨ una categoria e in particolare un gruppoide;
    \item dati $p, q âˆˆ X$, $p$ Ã¨ isomorfo a $q$ se e solo se $p$ e $q$ sono nella stessa componente connessa per archi;
    \item dato $p âˆˆ X$, $\Aut(X) = Ï€_1(X, x)$.
  \end{enumerate}
\end{exercise}

%\begin{proof}[Soluzione.]
%  \mbox{}
%  \begin{enumerate}
%    \item Dato un punto $p âˆˆ X$, $\id_p$ Ã¨ la classe del cammino costante su $p$; dati due cammini $f\colon [0,1] â†’ X$ e $g\colon [0,1] â†’ X$ con $f(1) = g(0)$, la composizione $[g] âˆ˜ [f]$ Ã¨ la classe della riparametrizzazione tra $0$ e $1$ di $f+g\colon [0,2] â†’ X$ ottenuta accostando $f$ e $g$. Ogni morfismo Ã¨ invertibile, dato che l'inversa di $[f]$ Ã¨ la classe di $-f\colon [0,1] â†’ X$ ottenuta percorrendo il cammino in senso opposto, quindi $Ï€_1(X)$ Ã¨ un gruppoide. Tutte queste operazioni sono ben definite modulo omotopia relativa.
%    \item Dati $p, q âˆˆ X$, $\Mor(p,q) â‰  âˆ…$ se e solo se esiste un cammino che collega $p$ e $q$; essendo $Ï€_1(X)$ un gruppoide, $\Mor(p,q) â‰  âˆ…$ se e solo se $p â‰… q$.
%    \item Per definizione di gruppo fondamentale.âˆŽ
%  \end{enumerate}
%\end{proof}

Osserviamo che i gruppi fondamentali con punti base $x$ e $y$ sono isomorfi se $x$ e $y$ sono isomorfi nel gruppoide $Ï€_1(X)$; questa Ã¨ una proprietÃ  piÃ¹ generale, come mostra il seguente esercizio.

\begin{exercise}\label{exercise:isomorfismo automorfismi gruppoide}
  Sia $G$ un gruppoide; se $x, y âˆˆ \Obj(G)$ sono isomorfi, allora esiste un isomorfismo $\Aut(x) â†’ \Aut(y)$, canonico a meno di coniugio con un automorfismo di $y$.
\end{exercise}

%\begin{proof}[Soluzione.]
%  Sia $Ï† âˆˆ \Mor(x, y)$ un isomorfismo; definiamo $\widetilde{Ï†}\colon \Aut(x) â†’ \Aut(y)$ ponendo $\widetilde{Ï†}(Ïˆ) â‰” Ï†âˆ˜Ïˆâˆ˜Ï†^{-1}$; $\widetilde{Ï†}$ Ã¨ iniettiva e suriettiva in quanto $Ï†$ Ã¨ invertibile. Se si considera un altro isomorfismo $Ï†â€² âˆˆ \Mor(x,y)$, allora $\widetilde{Ï†}â€²(Ïˆ) = Ïƒâˆ˜\widetilde{Ï†}(Ïˆ)âˆ˜Ïƒ^{-1}$ con $Ïƒ â‰” Ï†â€² âˆ˜ Ï†^{-1} âˆˆ \Mor(y,y)$.âˆŽ
%\end{proof}

In generale, gli oggetti di una categoria (ovvero di un gruppoide) sono una classe; nel seguito ignoreremo completamente di considerare questa complicazione; in particolare, lavoreremo solo su gruppoidi \emph{piccoli\/} (dove la classe degli oggetti Ã¨ un insieme) e usando l'assioma della scelta.

\begin{definition}
  Un funtore $F\colon G_1 â†’ G_2$ Ã¨ una \emph{equivalenza\/} se esiste $G\colon G_2 â†’ G_1$ tale che $Fâˆ˜G$ e $Gâˆ˜F$ sono naturalmente equivalenti all'identitÃ .
\end{definition}

\begin{exercise}\label{exercise:equivalenza di categorie}
  Il funtore $F$ Ã¨ un'equivalenza se e solo se sono vere entrambe le seguenti proposizioni:
  \begin{enumerate}
    \item $F$ Ã¨ \emph{pienamente fedele}, cioÃ¨ per ogni $x,xâ€²âˆˆG_1$, \[F\colon \Mor(x,xâ€²) â†’ \Mor(F(x), F(xâ€²))\] Ã¨ biunivoca;
    \item $F$ Ã¨ \emph{essenzialmente suriettivo}, cioÃ¨ per ogni $y âˆˆ G_2$ esiste $x âˆˆ G_1$ tale che $F(x)$ Ã¨ isomorfo a $y$.
  \end{enumerate}
  Per mostrare che le due condizioni implicano che $F$ sia un'equivalenza, Ã¨ necessario l'assioma della scelta.
\end{exercise}

%\begin{proof}[Soluzione.]
%  Se $F$ Ã¨ un'equivalenza mediante $G$, allora:
%  \begin{itemize}
%    \item $F$ Ã¨ fedele perchÃ© i morfismi $Ï†$ tra $x,y âˆˆ \Obj(G_1)$ compaiono in un diagramma commutativo del tipo
%  \[
%  \begin{tikzpicture}
%    \def\x{1.5}
%    \def\y{-1.2}
%    \node (A0_0) at (0*\x, 0*\y) {$x$};
%    \node (A0_1) at (1*\x, 0*\y) {$Gâˆ˜F(x)$};
%    \node (A1_0) at (0*\x, 1*\y) {$xâ€²$};
%    \node (A1_1) at (1*\x, 1*\y) {$Gâˆ˜F(xâ€²)$;};
%    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{}$} node [sloped] {$\scriptstyle{\widetilde{\ \ \ }}$} (A0_1);
%    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{}$} node [sloped] {$\scriptstyle{\widetilde{\ \ \ }}$} (A1_1);
%    \path (A0_1) edge [->] node [auto] {$\scriptstyle{Gâˆ˜F(Ï†)}$} (A1_1);
%    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{Ï†}$} (A1_0);
%  \end{tikzpicture}
%  \]
%      Ã¨ pieno perchÃ© dato $Ï† âˆˆ \mor(F(x), F(xâ€²))$, componendo $G(Ï†)$ con gli isomorfismi dell'equivalenza naturale otteniamo $Ïˆ âˆˆ \Mor(x, xâ€²)$ che commuta con $G(Ï†)$, cioÃ¨ $G(Ï†) = Gâˆ˜F(Ïˆ)$; ma anche $G$ Ã¨ fedele, quindi $Ï† = F(Ïˆ)$;
%    \item $F$ Ã¨ essenzialmente suriettivo: se $y âˆˆ G_2$, $F(G(y)) â‰… y$ dato che $Fâˆ˜G$ Ã¨ naturalmente equivalente a $\id_{G_2}$.
%  \end{itemize}
%  
%  Viceversa, se $F$ Ã¨ pienamente fedele e essenzialmente suriettivo, si puÃ² scegliere per ogni $y âˆˆ \Obj(G_2)$ un oggetto $G(y) âˆˆ \Obj(G_1)$ con un isomorfismo $Î·_y\colon F(G(y)) â†’ y$; se $Ï† âˆˆ \Mor_{G_2}(y, yâ€²)$, $G(Ï†) â‰” F^{-1}(Î·_{yâ€²}^{-1} âˆ˜ Ï† âˆ˜ Î·_y)$ (cosa possibile in quanto $F$ Ã¨ biunivoca sui morfismi). Allora le due equivalenze naturali $Ï„\colon Fâˆ˜G â‡’ \id_{G_2}$ e $Ïƒ\colon Gâˆ˜F â‡’ \id_{G_1}$ sono date da
%  \begin{align*}
%    Ï„_y &â‰” Î·_y\text{,} & Ïƒ_x &â‰” {F^{-1}(Î·_{F(x)})}^{-1}\text{.}âˆŽ
%  \end{align*}
%\end{proof}

\begin{theorem}
  Sia $G$ un gruppoide e sia $H$ un sottogruppoide tale che $\Obj(H)$ contenga esattamente un oggetto per ogni classe di isomorfismo di oggetti di $G$; richiediamo inoltre che $H$ sia un sottogruppoide \emph{pieno}, cioÃ¨ che per ogni $x,yâˆˆH$, $\Mor_H(x,y) = \Mor_G(x,y)$. Allora il funtore inclusione $H â†’ G$ Ã¨ un'equivalenza.
\end{theorem}

\begin{proof}
  Usiamo il criterio dell'esercizio~\ref{exercise:equivalenza di categorie}: l'inclusione Ã¨ essenzialmente suriettiva e pienamente fedele per definizione.âˆŽ
\end{proof}

\begin{definition}
  Un gruppoide in cui tutti i morfismi siano automorfismi si dice \emph{disconnesso}.
\end{definition}

\begin{remark}
  Ogni gruppoide $G$ ammette un sottogruppoide pieno $H$ che sia disconnesso, grazie all'assioma della scelta. Ovviamente in generale $H$ non Ã¨ univocamente determinato.
\end{remark}

\begin{definition}
  Possiamo associare a un insieme $S$ il gruppoide
  \[\defcat{S}{x}{y}{x âˆˆ S}{f}{x = y, f = \id_x}\]
\end{definition}

\begin{definition}
  Se $G$ Ã¨ un gruppoide, $Ï€_0(G)$ Ã¨ definito come l'insieme delle classi di equivalenza di oggetti di $G$ modulo gli isomorfismi in $G$.
\end{definition}

\begin{exercise}
  Siano $G$ un gruppoide, e $S$ un insieme; allora $\Mor(Ï€_0(G), S)$ Ã¨ in corrispondenza biunivoca con $\Fun(G, S)$, dove $S$ Ã¨ visto come gruppoide.
\end{exercise}

%\begin{proof}[Soluzione.]
%  A una mappa $Ï†\colon Ï€_0(G) â†’ S$ associamo il funtore $F\colon G â†’ S$ con $F(x) â‰” Ï†([x])$ e se $f âˆˆ \Mor(x,y)$, $F(Ï†) â‰” \id_{[x]}$ (dato che in tal caso $[x] = [y]$). Viceversa, se $F\colon G â†’ S$ Ã¨ un funtore, due oggetti isomorfi devono essere mandati da $F$ nello stesso oggetto (altrimenti non ci sarebbe un morfismo su cui mandare l'isomorfismo), per cui Ã¨ ben definita una mappa $Ï†\colon Ï€_0(G) â†’ S$ tramite $Ï†([x]) â‰” F(x)$.âˆŽ
%\end{proof}

\begin{definition}
  Un oggetto $x$ in un gruppoide Ã¨ \emph{rigido\/} se $\Aut(x) = \{\id\}$; un gruppoide Ã¨ \emph{rigido\/} se ogni oggetto Ã¨ rigido.
\end{definition}

\begin{exercise}
  \mbox{}
  \begin{enumerate}
    \item Se $x$ Ã¨ un oggetto rigido, ogni oggetto a lui isomorfo Ã¨ rigido;
    \item se $G$ Ã¨ un gruppoide rigido, Ã¨ equivalente al gruppoide associato a un insieme, in particolare Ã¨ equivalente a $Ï€_0(G)$.
  \end{enumerate}
\end{exercise}

%\begin{proof}[Soluzione.]
%  \mbox{}
%  \begin{enumerate}
%    \item Immediato dall'Esercizio~\ref{exercise:isomorfismo automorfismi gruppoide}.
%    \item Innanzitutto, se $G$ Ã¨ rigido, $\Mor(x,y)$ ha al piÃ¹ un elemento: se ne avesse piÃ¹ d'uno, la composizione del primo con l'inverso del secondo darebbe un automorfismo di $x$ diverso dall'identitÃ . Il funtore $F\colon G â†’ Ï€_0(G)$ Ã¨ ovvio; definiamo il funtore $H\colon Ï€_0(G) â†’ G$ grazie all'assioma della scelta, scegliendo per ogni classe $C âˆˆ Ï€_0(G)$ un oggetto $x âˆˆ \Obj(G)$ tale che $C = [x]$. Allora $Fâˆ˜H = \id_{Ï€_0(G)}$, mentre $Hâˆ˜F(xâ€²) = x$ se $x$ Ã¨ il rappresentante scelto della classe di $xâ€²$. Per quanto detto prima, $\Mor(xâ€², x)$ ha un solo elemento ed Ã¨ questo che realizza $Hâˆ˜F â‰… \id_G$.âˆŽ
%  \end{enumerate}  
%\end{proof}

\begin{exercise}
  Sia $F\colon G_1 â†’ G_2$ un funtore tra gruppoidi; se $G_2$ Ã¨ rigido, allora l'unica equivalenza naturale $F â‡’ F$ Ã¨ l'identitÃ .
\end{exercise}

%\begin{proof}[Soluzione.]
%  Un'equivalenza naturale $F â‡’ F$ Ã¨ il dato di un automorfismo di $F(x)$ per ogni $x âˆˆ \Obj(G_1)$ (piÃ¹ compatibilitÃ ).âˆŽ
%\end{proof}

\begin{exercise}
  Siano $X$ un insieme e $G$ un gruppo che agisce (a sinistra) su $X$; possiamo costruire un gruppoide che per adesso chiameremo $[X/G]$ in questo modo:
  \[\defcat{[X/G]}{x}{y}{x âˆˆ X}{g}{g âˆˆ G, gâ‹…x = y}\]
  Definire la composizione e dimostrare che questo Ã¨ un gruppoide; dimostrare inoltre che $\Mor([X/G]) â‰” \bigsqcup_{x,y âˆˆ XÃ—X} \Mor(x,y) = GÃ—X$. Trovare una b\^iezione naturale
  \[
  \biggl\{\begin{array}{c}\text{gruppoidi}\\ \text{rigidi}\end{array}\biggr\}
  \leftrightarrow
  \biggl\{(X, R) \biggm| \begin{array}{l} $X$ \text{ insieme,}\\ R âŠ† X Ã— X \text{ relazione d'equivalenza}\end{array}\biggr\}\text{.}
  \]
\end{exercise}

%\begin{proof}[Soluzione.]
%  Se $g âˆˆ \Mor(x,y)$ e $h âˆˆ \Mor(y,z)$, allora $gâ‹…x = y$ e $hâ‹…y = z$, da cui $hg â‹… x = z$ e definiamo $ hâˆ˜g â‰” hg âˆˆ \Mor(x, z)$. L'inverso di $g âˆˆ \Mor(x,y)$ Ã¨ $g^{-1} âˆˆ \Mor(y,x)$, quindi $[X/G]$ Ã¨ un gruppoide.
%  
%  Se $G$ Ã¨ un gruppoide rigido, lo consideriamo come un insieme con una relazione d'equivalenza ponendo $X â‰” \Obj(G)$ e $x âˆ¼ y$ se e solo se $\Mor(x, y) â‰  âˆ…$ (essendo rigido, ciÃ² implica che c'Ã¨ esattamente un morfismo da $x$ a $y$).âˆŽ
%\end{proof}

Possiamo quindi immaginare un gruppoide sia come un'estensione di un insieme, di un gruppo o di una relazione d'equivalenza.

\begin{definition}
  Un diagramma commutativo
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$V$};
    \node (A0_1) at (1*\x, 0*\y) {$X$};
    \node (A1_0) at (0*\x, 1*\y) {$Y$};
    \node (A1_1) at (1*\x, 1*\y) {$Z$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A0_1);
    \path (A1_0) edge [->] node [auto] {$\scriptstyle{}$} (A1_1);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{}$} (A1_1);
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A1_0);
  \end{tikzpicture}
  \]
  in una categoria $â„­$ si dice \emph{cartesiano\/} se per ogni diagramma commutativo del tipo
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$Vâ€²$};
    \node (A1_1) at (1*\x, 1*\y) {$V$};
    \node (A1_2) at (2*\x, 1*\y) {$X$};
    \node (A2_1) at (1*\x, 2*\y) {$Y$};
    \node (A2_2) at (2*\x, 2*\y) {$Z$};
    \path (A0_0) edge [->,bend left=20] node [auto] {$\scriptstyle{}$} (A1_2);
    \path (A1_1) edge [->] node [auto] {$\scriptstyle{}$} (A1_2);
    \path (A0_0) edge [->,bend left=-20] node [auto] {$\scriptstyle{}$} (A2_1);
    \path (A1_1) edge [->] node [auto] {$\scriptstyle{}$} (A2_1);
    \path (A2_1) edge [->] node [auto] {$\scriptstyle{}$} (A2_2);
    \path (A1_2) edge [->] node [auto] {$\scriptstyle{}$} (A2_2);
  \end{tikzpicture}
  \]
  esiste unico un morfismo $Vâ€² â†’ V$ che commuta con il diagramma.
\end{definition}

In particolare, se $â„­ = \Sets$, dati $f\colon X â†’ Z$ e $g\colon Y â†’ Z$, possiamo definire il loro \emph{prodotto fibrato\/} come \[ X Ã—_Z Y â‰” \{(x,y) âˆˆ X Ã— Y \mid f(x) = g(y)\}\text{;} \] Ã¨ ben noto che il prodotto fibrato con le due proiezioni rende il diagramma cartesiano; inoltre ogni insieme che rende cartesiano il diagramma Ã¨ isomorfo a $X Ã—_Z Y$, grazie alla proprietÃ  universale.

Vogliamo trovare un'analoga proprietÃ  universale per la cartesianitÃ  nel contesto delle $2$-categorie (o piÃ¹ in particolare, per i gruppoidi).

\begin{definition}
  Siano $f\colon X â†’ Z$ e $g\colon Y â†’ Z$ morfismi di gruppoidi; si definisce il \emph{prodotto fibrato\/}  
  \[\defcat{X Ã—_Z Y}{(x, y, Ï†)}{(xâ€², yâ€², Ï†â€²)}{
    \left\{\begin{array}{l} x âˆˆ \Obj(X), y âˆˆ \Obj(Y),\\ Ï† âˆˆ \Mor_Z(f(x),g(y))\end{array}\right.
  }{(Î±,Î²)}{
    \left\{\begin{array}{l}
    Î± âˆˆ \Mor_X(x, xâ€²),\\
     Î² âˆˆ \Mor_Y(y, yâ€²)\\
      \begin{tikzpicture}[baseline]
        \def\x{1.5}
        \def\y{-1.2}
        \node (A0_0) at (0*\x, -.5*\y) {$f(x)$};
        \node (A0_1) at (1*\x, -.5*\y) {$f(y)$};
        \node (A1_0) at (0*\x, .5*\y) {$g(x)$};
        \node (A1_1) at (1*\x, .5*\y) {$g(y)$};
        \node (A2_2) at (.5*\x, 0*\y) {$â†»$};
        \path (A0_0) edge [->] node [auto] {$\scriptstyle{Ï†}$} (A0_1);
        \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{Ï†â€²}$} (A1_1);
        \path (A0_1) edge [->] node [auto] {$\scriptstyle{f(Î²)}$} (A1_1);
        \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{f(Î±)}$} (A1_0);
      \end{tikzpicture}
    \end{array}
  \right.
  }
\]
\end{definition}

\begin{lemma}
  Il prodotto fibrato ha una naturale struttura di gruppoide.
\end{lemma}

\begin{proof}
  L'identitÃ  dell'oggetto $(x, y, Ï†)$ Ã¨ data da $(\id_x, \id_y)$; la composizione di \[ (x, y, Ï†) \xra{(Î±,Î²)} (xâ€², yâ€², Ï†â€²) \xra{(Î±â€², Î²â€²)} (xâ€³, yâ€³, Ï†â€³) \] Ã¨ $(Î±â€²âˆ˜Î±, Î²â€²âˆ˜Î²)$, ben definito in quanto
  \[
  \begin{tikzpicture}
    \def\x{2}
    \def\y{-1.6}
    \node (A0_0) at (0*\x, 0*\y) {$f(x)$};
    \node (A0_1) at (1*\x, 0*\y) {$g(y)$};
    \node (A1_0) at (0*\x, 1*\y) {$f(xâ€²)$};
    \node (A1_1) at (1*\x, 1*\y) {$g(yâ€²)$};
    \node (A2_0) at (0*\x, 2*\y) {$f(xâ€³)$};
    \node (A2_1) at (1*\x, 2*\y) {$g(yâ€³)$.};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{Ï†}$} (A0_1);
    \path (A0_1) edge [->,bend left=45] node [auto] {$\scriptstyle{g(Î²â€²âˆ˜Î²)}$} (A2_1);
    \path (A1_0) edge [->] node [auto] {$\scriptstyle{Ï†â€²}$} (A1_1);
    \path (A1_0) edge [->] node [auto] {$\scriptstyle{f(Î±â€²)}$} (A2_0);
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{f(Î±)}$} (A1_0);
    \path (A0_0) edge [->,bend right=45] node [auto,swap] {$\scriptstyle{f(Î±â€²âˆ˜Î±)}$} (A2_0);
    \path (A0_1) edge [->] node [auto,swap] {$\scriptstyle{g(Î²)}$} (A1_1);
    \path (A2_0) edge [->] node [auto] {$\scriptstyle{Ï†â€³}$} (A2_1);
    \path (A1_1) edge [->] node [auto,swap] {$\scriptstyle{g(Î²â€²)}$} (A2_1);
  \end{tikzpicture}
  \]
  L'inverso di $(Î±, Î²)$ Ã¨ $(Î±^{-1}, Î²^{-1})$.âˆŽ
\end{proof}

\begin{definition}
  Definiamo i funtori $p_1\colon X Ã—_Z Y â†’ X$ e $p_2\colon X Ã—_Z Y â†’ Y$ ponendo
  \begin{align*}
    p_1(x,y,z) &â‰” x & p_1(Î±,Î²) &â‰” Î±\text{,}\\
    p_2(x,y,z) &â‰” y & p_2(Î±,Î²) &â‰” Î²\text{.}
  \end{align*}
\end{definition}

Osserviamo che il diagramma 
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$XÃ—_Z Y$};
    \node (A0_1) at (1*\x, 0*\y) {$X$};
    \node (A1_0) at (0*\x, 1*\y) {$Y$};
    \node (A1_1) at (1*\x, 1*\y) {$Z$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{p_1}$} (A0_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{g}$} (A1_1);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{f}$} (A1_1);
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{p_2}$} (A1_0);
  \end{tikzpicture}
  \]
in generale non commuta, dato che $f âˆ˜ p_1(x,y,Ï†) = f(x)$ mentre $gâˆ˜p_2(x,y,Ï†) = g(y)$.

\begin{lemma}
  Esiste un'equivalenza naturale $Ï\colon p_1 âˆ˜ f â‡’ p_2 âˆ˜ g$ data da \[ Ï(x,y,Ï†) â‰” Ï†\colon f(x) â†’ g(y)\text{.}\]
\end{lemma}

\begin{proof}
  Immediato dalla definizione di $X Ã—_Z Y$.âˆŽ
\end{proof}

L'ultima cosa da fare Ã¨ adattare la proprietÃ  universale di diagramma cartesiano alle $2$-categorie e dimostrare che il prodotto fibrato di gruppoidi la soddisfa.

\begin{theorem}\label{theorem:prodotto fibrato cartesiano}
  Sia
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$V$};
    \node (A0_1) at (1*\x, 0*\y) {$X$};
    \node (A1_0) at (0*\x, 1*\y) {$Y$};
    \node (A1_1) at (1*\x, 1*\y) {$Z$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{q_1}$} (A0_1);
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{q_2}$} (A1_0);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{f}$} (A1_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{g}$} (A1_1);
    \path (A1_0) -- (A0_1) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{Î·}$};
  \end{tikzpicture}
  \]
  un diagramma $2$-commutativo; allora esiste unica $h\colon V â†’ XÃ—_Y Z$ tale che
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$V$};
    \node (A1_1) at (1*\x, 1*\y) {$X Ã—_Z Y$};
    \node (A1_2) at (2*\x, 1*\y) {$X$};
    \node (A2_1) at (1*\x, 2*\y) {$Y$};
    \node (A2_2) at (2*\x, 2*\y) {$Z$};
    \path (A0_0) edge [->,bend left=40] node [auto] {$\scriptstyle{q_1}$} (A1_2);
    \path (A1_1) edge [->] node [auto] {$\scriptstyle{p_1}$} (A1_2);
    \path (A1_2) edge [->] node [auto] {$\scriptstyle{f}$} (A2_2);
    \path (A0_0) edge [->] node [auto,near start] {$\scriptstyle{h}$} (A1_1);
    \path (A1_1) edge [->] node [auto,swap] {$\scriptstyle{p_2}$} (A2_1);
    \path (A2_1) edge [->] node [auto,swap] {$\scriptstyle{g}$} (A2_2);
    \path (A0_0) edge [->,bend right=40] node [auto,swap] {$\scriptstyle{q_2}$} (A2_1);
    \path (A2_1) -- (A1_2) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{Ï}$};
    \path (0.1*\x,1.4*\y) -- (.7*\x,.7*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{\id}$};
    \path (.7*\x,.7*\y) -- (1.4*\x,0.1*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{\id}$};
  \end{tikzpicture}
  \]
  Ã¨ $2$-commutativo; in particolare
  \begin{itemize}
    \item $q_1 = h âˆ˜ p_1$,
    \item $q_2 = h âˆ˜ p_2$,
    \item $Ï$ induce $Î·$.
  \end{itemize}  
\end{theorem}

\begin{proof}
  Il fatto che $Î·$ sia una trasformazione naturale che rende il primo diagramma $2$-commutativo si traduce in questo modo: \[ âˆ€ v âˆˆ \Obj(V), Î·(v)\colon f(q_1(v)) â†’ g(q_2(v))\text{.} \] Dobbiamo definire $h(v)$: l'unica scelta plausibile Ã¨ $h(v) â‰” (q_1(v), q_2(v), Î·(v))$, mentre per un morfismo $Ïˆ\colon v_1 â†’ v_2$, $h(Ïˆ) â‰” (q_1(Ïˆ), q_2(Ïˆ))$. Rimangono da verificare che queste siano buone definizioni, in particolare che $h(Ïˆ)$ sia un morfismo e che il diagramma
  \[
  \begin{tikzpicture}
    \def\x{2.5}
    \def\y{-1.6}
    \node (A0_0) at (0*\x, 0*\y) {$f(q_1(v_1))$};
    \node (A0_1) at (1*\x, 0*\y) {$g(q_2(v_1))$};
    \node (A1_0) at (0*\x, 1*\y) {$f(q_1(v_2))$};
    \node (A1_1) at (1*\x, 1*\y) {$g(q_2(v_2))$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{Î·(v_1)}$} (A0_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{Î·(v_2)}$} (A1_1);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{g(q_2(Ïˆ))}$} (A1_1);
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{f(q_1(Ïˆ))}$} (A1_0);
  \end{tikzpicture}
  \]
  commuta, cosa che Ã¨ evidente dal fatto che $Î·$ Ã¨ un'equivalenza naturale. L'ultima condizione, che $Ï$ induce $Î·$, si traduce semplicemente dicendo che l'ultima componente di $h(v)$ deve essere $Î·(v)$, come definito in precedenza.âˆŽ
\end{proof}

Abbiamo cambiato la proprietÃ  universale, ma in un certo senso non molto: i $2$-morfismi in alto e a sinistra devono essere l'identitÃ . In realtÃ  quella esposta Ã¨ una versione edulcorata della definizione di diagramma $2$-cartesiano.

\begin{definition}
  Un diagramma $2$-commutativo
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$V$};
    \node (A0_1) at (1*\x, 0*\y) {$X$};
    \node (A1_0) at (0*\x, 1*\y) {$Y$};
    \node (A1_1) at (1*\x, 1*\y) {$Z$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{q_1}$} (A0_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{g}$} (A1_1);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{f}$} (A1_1);
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{q_2}$} (A1_0);
    \path (A1_0) -- (A0_1) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{Î·}$};
  \end{tikzpicture}
  \]
  si dice \emph{$2$-cartesiano\/} se il funtore $h\colon V â†’ X Ã—_Z Y$ definito nel Teorema~\ref{theorem:prodotto fibrato cartesiano} Ã¨ un'equivalenza di gruppoidi.
\end{definition}

\begin{proposition}
  Un diagramma $2$-cartesiano ha la seguente proprietÃ  universale: per ogni diagramma $2$-commutativo
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$Vâ€²$};
    \node (A0_1) at (1*\x, 0*\y) {$X$};
    \node (A1_0) at (0*\x, 1*\y) {$Y$};
    \node (A1_1) at (1*\x, 1*\y) {$Z$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{q_1â€²}$} (A0_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{g}$} (A1_1);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{f}$} (A1_1);
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{q_2â€²}$} (A1_0);
    \path (A1_0) -- (A0_1) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{Î·â€²}$};
  \end{tikzpicture}
  \]
  esiste un funtore $hâ€²\colon Vâ€² â†’ V$ ed esistono dei $2$-morfismi $Î¸_1â€²\colon q_1 âˆ˜ hâ€² â‡’ q_1â€²$ e $Î¸_2â€²\colon q_2 âˆ˜ hâ€² â‡’ q_2â€²$ tale che
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$Vâ€²$};
    \node (A1_1) at (1*\x, 1*\y) {$V$};
    \node (A1_2) at (2*\x, 1*\y) {$X$};
    \node (A2_1) at (1*\x, 2*\y) {$Y$};
    \node (A2_2) at (2*\x, 2*\y) {$Z$};
    \path (A0_0) edge [->,bend left=40] node [auto] {$\scriptstyle{q_1â€²}$} (A1_2);
    \path (A1_1) edge [->] node [auto] {$\scriptstyle{q_1}$} (A1_2);
    \path (A1_2) edge [->] node [auto] {$\scriptstyle{f}$} (A2_2);
    \path (A0_0) edge [->] node [auto,near start] {$\scriptstyle{hâ€²}$} (A1_1);
    \path (A1_1) edge [->] node [auto,swap] {$\scriptstyle{q_2}$} (A2_1);
    \path (A2_1) edge [->] node [auto,swap] {$\scriptstyle{g}$} (A2_2);
    \path (A0_0) edge [->,bend right=40] node [auto,swap] {$\scriptstyle{q_2â€²}$} (A2_1);
    \path (A2_1) -- (A1_2) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{Ï}$};
    \path (0.1*\x,1.4*\y) -- (.7*\x,.7*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{Î¸_2â€²}$};
    \path (.7*\x,.7*\y) -- (1.4*\x,0.1*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{Î¸_1â€²}$};
  \end{tikzpicture}
  \]
  induce $Î·â€²$. Inoltre $(hâ€², Î¸_1â€², Î¸_2â€²)$ sono unici a meno di $2$-isomorfismo, cioÃ¨ dati $(hâ€³, Î¸_1â€³, Î¸_2â€³)$ con le stesse proprietÃ , esiste unico $Î´\colon hâ€² â‡’ hâ€³$ tale che il diagramma (visto prima da sopra e poi da sotto)
  \begin{align*}
  &\begin{tikzpicture}
    \def\x{1.2}
    \def\y{3}
    \node (A0_0) at (0*\x, 1*\y) {$Vâ€²$};
    \node (A0_1) at (0*\x, 0*\y) {$X$};
    \path (A0_0) edge [->,bend left=70] node [auto] {$\scriptstyle{q_1 âˆ˜ hâ€²}$} (A0_1);
    \path (A0_0) edge [->] node [auto,near end] {$\scriptstyle{q_1â€²}$} (A0_1);
    \path (A0_0) edge [->,bend right=70] node [auto,swap] {$\scriptstyle{q_1âˆ˜ hâ€³}$} (A0_1);
    \path (-1*\x, 0.5*\y) -- (0*\x, 0.5*\y) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.5,auto,sloped] {$\scriptstyle{Î¸_1â€²}$};
    \path (1*\x, 0.5*\y) -- (0*\x, 0.5*\y) 
      node [pos=0.5,allow upside down,sloped] {$\Longrightarrow$}
      node [pos=0.5,auto,swap,sloped] {$\scriptstyle{Î¸_1â€³}$};
  \end{tikzpicture}
  &&\begin{tikzpicture}
    \def\x{1.2}
    \def\y{3}
    \node (A0_0) at (0*\x, 1*\y) {$Vâ€²$};
    \node (A0_1) at (0*\x, 0*\y) {$X$};
    \path (A0_0) edge [->,bend left=70] node [auto] {$\scriptstyle{q_1 âˆ˜ hâ€³}$} (A0_1);
    \path (A0_0) edge [->,bend right=70] node [auto,swap] {$\scriptstyle{q_1âˆ˜ hâ€²}$} (A0_1);
    \path (0.5*\x, 0.5*\y) -- (-0.5*\x, 0.5*\y) 
      node [pos=0.5,allow upside down,sloped] {$\Longrightarrow$}
      node [pos=0.5,auto,swap,sloped] {$\scriptstyle{q_1(Î´)}$};
  \end{tikzpicture}
  \end{align*}
  sia $2$-commutativo, e allo stesso modo per $Î¸_2â€²$ e $Î¸_2â€³$.
\end{proposition}

Ãˆ possibile usare la semplificazione vista all'inizio in quanto si dimostra che tra questi dati ne esiste sempre uno con $Î¸_1â€² = \id$ e $Î¸_2â€² = \id$.

\begin{exercise}
  Se $X$, $Y$, $Z$ sono insiemi e $Xâ€²$, $Yâ€²$, $Zâ€²$ sono gli stessi insiemi visti come gruppoidi, allora $Xâ€² Ã—_{Zâ€²} Yâ€²$ Ã¨ l'insieme $X Ã—_Z Y$ visto come gruppoide
\end{exercise}

\begin{proof}[Soluzione.]
  Sia $(x, y, Ï†) âˆˆ Xâ€² Ã—_{Zâ€²} Yâ€²$, cioÃ¨ $x âˆˆ X$, $y âˆˆ Y$ e $Ï†\colon f(x) â†’ g(y)$; allora $f(x) = g(y)$ e $Ï† = \id$, dato che $Z$ Ã¨ un insieme; mentre un morfismo da $(x, y, \id_{f(x)}$ a $(xâ€², yâ€², \id_{f(xâ€²)})$ puÃ² essere solo $(\id_x, \id_{y})$ se $x = xâ€²$ e $y = yâ€²$.âˆŽ
\end{proof}

\begin{exercise}
  Il prodotto fibrato Ã¨ stabile, modulo equivalenza, sostituendo $X$, $Y$, $Z$ con gruppoidi equivalenti. Per esempio, se $a\colon Xâ€² â†’ X$ Ã¨ un'equivalenza naturale, allora $a$ induce un'equivalenza $Xâ€²Ã—_Z Y â†’ XÃ—_Z Y$; lo stesso per $b\colon Yâ€² â†’ Y$ e $c\colon Z â†’ Zâ€²$.
\end{exercise}

%\begin{proof}[Soluzione]
%  Sia $Ïƒ\colon Xâ€² â†’ X$ un'equivalenza naturale e consideriamo il diagramma
%  \[
%  \begin{tikzpicture}
%    \def\x{1.5}
%    \def\y{-1.2}
%    \node (A0_0) at (0*\x, 0*\y) {$Xâ€² Ã—_Z Y$};
%    \node (A0_1) at (1*\x, 0*\y) {$Xâ€²$};
%    \node (A1_0) at (0*\x, 1*\y) {$X Ã—_Z Y$};
%    \node (A1_1) at (1*\x, 1*\y) {$X$};
%    \node (A2_0) at (0*\x, 2*\y) {$Y$};
%    \node (A2_1) at (1*\x, 2*\y) {$Z$.};
%    \path (A0_0) edge [->] node [auto] {$\scriptstyle{q_1â€²}$} (A0_1);
%    \path (A2_0) edge [->] node [auto,swap] {$\scriptstyle{g}$} (A2_1);
%    \path (A1_0) edge [->] node [auto] {$\scriptstyle{q_1}$} (A1_1);
%    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{q_2}$} (A2_0);
%    \path (A1_1) edge [->] node [auto] {$\scriptstyle{f}$} (A2_1);
%    \path (A0_0) edge [->,bend right=60] node [auto,swap] {$\scriptstyle{q_2â€²}$} (A2_0);
%    \path (A0_1) edge [->] node [auto] {$\scriptstyle{Ïƒ}$} (A1_1);
%  \end{tikzpicture}
%  \]
%  Definiamo un'equivalenza $Ï„\colon Xâ€²Ã—_Z Y â†’ XÃ—_Z Y$ ponendo
%  \begin{align*}
%    Ï„(xâ€²,y,Ï†) &â‰” (Ïƒ(xâ€²), y, Ï†)\text{,} & Ï„(Î±â€², Î²) &â‰” (Ïƒ(Î±â€²), Î²)\text{.}
%  \end{align*}
%  Si procede allo stesso modo per $Y$ e $Z$.âˆŽ
%\end{proof}

\begin{proposition}
  Sia $G$ un gruppoide che agisce su un insieme $X$. Denotiamo $Xâ€²$ il gruppoide associato a $X$; definiamo $Ï€\colon Xâ€² â†’ [X/G]$ ponendo
  \begin{align*}
    Ï€(x) &â‰” x\text{,} & Ï€(\id_x) &â‰” \id_x\text{,}
  \end{align*}
  $p_2\colon G Ã— Xâ€² â†’ Xâ€²$ con $p_2(g, x) â‰” x$ e $a\colon GÃ—Xâ€² â†’ Xâ€²$ con $a(g, x) â‰” gâ‹…x$. Il diagramma 
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$GÃ—Xâ€²$};
    \node (A0_1) at (1*\x, 0*\y) {$Xâ€²$};
    \node (A1_0) at (0*\x, 1*\y) {$Xâ€²$};
    \node (A1_1) at (1*\x, 1*\y) {$[X/G]$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{a}$} (A0_1);
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{p_2}$} (A1_0);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{Ï€}$} (A1_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{Ï€}$} (A1_1);
    \path (A1_0) -- (A0_1) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{Î·}$};
  \end{tikzpicture}
  \]
  Ã¨ naturalmente $2$-commutativo tramite un $2$-morfismo $Î·$, che inoltre rende il diagramma cartesiano.
\end{proposition}

\begin{proof}
  Sia $(g, x) âˆˆ \Obj(G Ã— Xâ€²)$; allora $(Ï€âˆ˜p_2)(g,x) = x$, mentre $(Ï€âˆ˜p_1)(g,x) = gâ‹…x$; l'unico modo per definire $Î·$ Ã¨ ponendo $Î·(g,x) â‰” g âˆˆ \Mor_{[X/G]}(x, gâ‹…x)$.
  
  Sia ora $Y$ il prodotto fibrato $Xâ€² Ã—_{[X/G]} Xâ€²$; i suoi oggetti sono triple $(x_1, x_2, g)$ con $x_1, x_2 âˆˆ X$ e $g âˆˆ G$ tale che $gâ‹…x_1 = x_2$. I morfismi tra $(x_1, x_2, g)$ e $(x_1â€², x_2â€², gâ€²)$ sono coppie di morfismi $x_1 â†’ x_1â€²$ e $x_2 â†’ x_2â€²$, quindi necessariamente, dato che $X$ Ã¨ un insieme, non ci sono morfismi se $x_1 â‰  x_1â€²$ o $x_2 â‰  x_2â€²$; inoltre, perchÃ© $(\id_{x_1}, \id_{x_2})$ sia davvero un morfismo, il diagramma
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$x_1$};
    \node (A0_1) at (1*\x, 0*\y) {$x_2$};
    \node (A1_0) at (0*\x, 1*\y) {$x_1$};
    \node (A1_1) at (1*\x, 1*\y) {$x_2$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{g}$} (A0_1);
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{\id_{x_1}}$} (A1_0);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{\id_{x_2}}$} (A1_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{g}$} (A1_1);
  \end{tikzpicture}
  \]
  deve commutare. In definitiva, gli unici morfismi sono le identitÃ  se le due triple sono uguali, cioÃ¨ $Y$ Ã¨ un insieme. L'applicazione $GÃ—Xâ€² â†’ Y$, indotta dal fatto che $Y$ Ã¨ un prodotto fibrato, Ã¨ data da $(g,x) â†¦ (x, gâ‹…x, g)$, come applicazione tra insiemi, che Ã¨ chiaramente biunivoca (l'inversa dimentica il secondo elemento della tripla).âˆŽ
\end{proof}

Ritornando agli insiemi, consideriamo l'azione di un gruppo $G$ su un insieme $X$. Possiamo costruire un insieme quoziente $X/G$ e un diagramma commutativo
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$GÃ—X$};
    \node (A0_1) at (1*\x, 0*\y) {$X$};
    \node (A1_0) at (0*\x, 1*\y) {$X$};
    \node (A1_1) at (1*\x, 1*\y) {$X/G$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{a}$} (A0_1);
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{p_2}$} (A1_0);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{Ï€}$} (A1_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{Ï€}$} (A1_1);
  \end{tikzpicture}
  \]
dove $a$ Ã¨ l'azione e $p_2$ la proiezione.

\begin{exercise}
  Il diagramma Ã¨ cartesiano se e solo se l'azione di $G$ Ã¨ libera (cioÃ¨ se ogni stabilizzatore Ã¨ banale).\TODO{}
\end{exercise}

%\begin{proof}[Soluzione.]
%  Sia \[ Y â‰” X Ã—_{X/G} X = \{(x_1, x_2) \mid âˆƒ g âˆˆ G\colon g x_1 = x_2 \}\text{;} \] se $O_1, â€¦$ sono le orbite di $G$ in $X$, $Y = \bigsqcup O_i Ã— O_i$. Consideriamo la mappa $f\colon GÃ—X â†’ XÃ—X$ con $f(g,x) â‰” (gâ‹…x, x)$. Se l'azione Ã¨ libera, $f$ Ã¨ iniettiva, e la sua immagine Ã¨ $Y$, quindi il diagramma Ã¨ cartesiano. Viceversa, se il diagramma Ã¨ cartesiano, esiste un isomorfismo $f\colon GÃ—X â†’ Y$. Se per assurdo l'azione non fosse libera, esisterebbe $(g,x) âˆˆ GÃ—X$ tale che $gâ‹…x = x$ e $g â‰  e$. In particolare, $p_2(e,x) = x = p_2(g,x)$ e $a(e,x) = x = a(g,x)$. Ma allora $q_i(f(e,x)) = q_i(f(g,x))$ per $i âˆˆ\{1,2\}$, dove $q_1, q_2\colon Y â†’ X$ sono le due proiezioni; di conseguenza, $f(e,x) = f(g,x)$ assurdo.âˆ¥âˆŽ
%\end{proof}

\begin{remark}
  Sia $x âˆˆ \Obj([X/G])$; allora $\Aut(x) = \Stab_G(x)$. Quindi considerando i gruppoidi, tutte le azioni di gruppo si comportano come un'azione libera.
\end{remark}

\begin{definition}
  Sia $G$ un gruppoide; il \emph{gruppoide d'inerzia\/} associato a $G$ Ã¨
  \[\defcat{\I(G)}{(x, Ï†)}{(y, Ïˆ)}{x âˆˆ \Obj(G), Ï† âˆˆ \Aut(x)}{Ïƒ\colon x â†’ y}{
  \begin{tikzpicture}[baseline]
    \def\x{1}
    \def\y{-0.8}
    \node (A0_0) at (0*\x, -.5*\y) {$x$};
    \node (A0_1) at (1*\x, -.5*\y) {$x$};
    \node (A1_0) at (0*\x, .5*\y) {$y$};
    \node (A1_1) at (1*\x, .5*\y) {$y$};
    \node (A2_2) at (.5*\x, 0*\y) {$â†»$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{Ï†}$} (A0_1);
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{Ïƒ}$} (A1_0);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{Ïƒ}$} (A1_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{Ïˆ}$} (A1_1);
  \end{tikzpicture}}\]
  inoltre si definisce una proiezione $Ï€\colon \I(G) â†’ G$ ponendo $Ï€(x, Ï†) â‰” x$ e $Ï€(Ïƒ) â‰” Ïƒ$.
\end{definition}

\begin{exercise}
  Esiste un naturale $2$-morfismo $Î·$ che rende il diagramma
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$\I(G)$};
    \node (A0_1) at (1*\x, 0*\y) {$G$};
    \node (A1_0) at (0*\x, 1*\y) {$G$};
    \node (A1_1) at (1*\x, 1*\y) {$GÃ—G$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{Ï€}$} (A0_1);
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{Ï€}$} (A1_0);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{Î”_G}$} (A1_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{Î”_G}$} (A1_1);
    \path (A1_0) -- (A0_1) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{Î·}$};
  \end{tikzpicture}
  \]
  $2$-cartesiano.  
\end{exercise}

\begin{proof}[Solution.]
  We have to define $Î·_{(x,Ï†)}\colon (x,x) â†’ (x,x)$, that is, $Î·_{(x,Ï†)} = (Î±_{(x,Ï†)}, Î²_{(x,Ï†)})$. Moreover, both $Î±$ and $Î²$ have to commute with any morphism $Ïƒ\colon x â†’ y$. The natural answer is to set $Î±_{(x,Ï†)} = Ï† = Î²_{(x, Ï†)}$, since $Ï†$ commutes with $Ïƒ$ by definition of $\I(G)$.âˆŽ
\end{proof}

\section{Schemes as functors}\lecture[2 hours]{15}{01}{2009}
As we said, after defining groupoids and seeing some of their properties, we need to reshape the definition of scheme in order to make evident the fact that their morphisms form a set. The key to do this is Yoneda lemma.

\begin{definition}
  If $â„­$ is any category, there is a natural functor \[ \ho\colon â„­ â†’ \Fun(â„­^{\opp}, \Sets) \] associating to an object $X$ the functor $\ho_X$ defined by \[ \ho_X(Y) â‰” \Mor_â„­(Y, X)\text{,} \qquad \ho_X(f\colon Y â†’ Z)\colon \Mor_â„­(Z, X) \xra{(\phaâˆ˜f)} \Mor_â„­(Y, X)\text{.} \]
\end{definition}

\begin{lemma}[Yoneda]
  The natural map $\Mor(\ho_X, F) â†’ F(X)$ associating $Î±(\id_X)$ to $Î±\colon \ho_X â‡’ F$ is a bijection for every $F\colon â„­^\opp â†’ \Sets$.
\end{lemma}

\begin{corollary}
  The functor $\ho$ is fully faithful.
\end{corollary}

\begin{proof}
  By Yoneda lemma, $\Mor(\ho_X, \ho_Y)$ is bijective to $\ho_Y(X) â‰” \Mor(X, Y)$.
\end{proof}

\begin{definition}
  A functor $F\colon â„­^{\opp} â†’ \Sets$ is called \emph{representable\/} if there exist $X âˆˆ \Obj(â„­)$ and $Î± âˆˆ F(X)$ (that is, $Î±\colon \ho_X â‡’ F$) such that $Î±$ is a natural equivalence. In such a situation, we say that $X$ (or better, the couple $(X, Î±)$) \emph{represents\/} $F$.
\end{definition}

We can view the property that fibered product is defined up to canonical isomorphism in another way thanks to representability.

\begin{lemma}
  If both $(X, Î±)$ and $(Xâ€², Î±â€²)$ represent $F$, then there is an unique isomorphism $f\colon X â†’ Xâ€²$ such that the diagram
  \[
  \begin{tikzpicture}
    \def\x{0.8}
    \def\y{-1.2}
    \node (A0_0) at (150:\x) {$\ho_X$};
    \node (A0_2) at (30:\x) {$\ho_{Xâ€²}$};
    \node (A1_1) at (270:\x) {$F$};
    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{Î±}$} (A1_1);
    \path (A0_2) edge [->] node [auto] {$\scriptstyle{Î±â€²}$} (A1_1);
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{f}$} (A0_2);
  \end{tikzpicture}
  \]
  commutes.
\end{lemma}

In particular, there could be many isomorphisms, but only one commutes with $Î±$ and $Î±â€²$.

\begin{definition}
  Let $â„­$ be a category; we say that \emph{fiber products exist\/} in $â„­$ if we can complete every diagram
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_1) at (1*\x, 0*\y) {$X$};
    \node (A1_0) at (0*\x, 1*\y) {$Y$};
    \node (A1_1) at (1*\x, 1*\y) {$Z$};
    \path (A1_0) edge [->] node [auto] {$\scriptstyle{}$} (A1_1);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{}$} (A1_1);
  \end{tikzpicture}
  \]  
  to a cartesian diagram
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$W$};
    \node (A0_1) at (1*\x, 0*\y) {$X$};
    \node (A1_0) at (0*\x, 1*\y) {$Y$};
    \node (A1_1) at (1*\x, 1*\y) {$Z$.};
    \node (B1_1) at (.5*\x, .5*\y) {$\square$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A0_1);
    \path (A1_0) edge [->] node [auto] {$\scriptstyle{}$} (A1_1);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{}$} (A1_1);
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A1_0);
  \end{tikzpicture}
  \]
\end{definition}  

\begin{lemma}
  For any category $â„­$, the category $\Fun(â„­^{\opp}, \Sets)$ has fiber products.
\end{lemma}

\begin{proof}
  Given such a diagram, let $W(A) â‰” X(A) Ã—_{Z(A)} Y(A)$; for a morphism $f\colon A â†’ B$, we have projections $W(B) â†’ X(B)$ and $W(B) â†’ Y(B)$ and also the maps $X(f)\colon X(B) â†’ X(A)$ and $Y(f)\colon Y(B) â†’ Y(A)$; since $W(B)$ is a fiber product, we have an induced map $W(f)\colon W(B) â†’ W(A)$. It is an easy check that $W$ is a functor and that there are natural morphisms $W â†’ X$ and $W â†’ Y$ such that $W$ with these morphisms complete a cartesian diagram.âˆŽ
\end{proof}

\begin{exercise}
  A category $â„­$ has fiber product if and only if for every $f\colon X â†’ Z$ and $g\colon Y â†’ Z$, the functor $\ho_X Ã—_{\ho_Z} \ho_Y$ is representable.
\end{exercise}

\begin{proof}[Solution.]
  Let $F â‰” \ho_X Ã—_{\ho_Z} \ho_Y$; if $F$ is representable, $F$ is naturally equivalent to $\ho_W$ for some $W âˆˆ \Obj(â„­)$. Via this equivalence, we have that $\id_W âˆˆ \ho_W(W)$ corresponds to some element $Î± âˆˆ F(W)$; but $F(W)$ has two projections $p_1$ and $p_2$ to $\ho_X$ and $\ho_Y$, so we define $q_1 â‰” p_1(W)(Î±)$ and $q_2 â‰” p_2(W)(Î±)$. These morphisms make the diagram commute, since $\ho(f) âˆ˜ p_1 = \ho(g) âˆ˜ p_2$. Moreover the diagram is cartesian since from $(V, s_1\colon V â†’ X, s_2\colon V â†’ Y)$ we get morphisms $\ho(s_1)\colon \ho_V â‡’ \ho_X$ and $\ho(s_2)\colon \ho_V â‡’ \ho_X$ and by cartesianity a morphism $Ï„\colon \ho_V â‡’ \ho_W$; from this, the desired morphism $Ï„(V)(\id_V)$.
  
  Viceversa, if $X Ã—_Z Y$ exists, it represents of $\ho_X Ã—_{\ho_Y} \ho_Z$.âˆŽ
\end{proof}

In some sense, we proved that if we enlarge enough the category (for example considering the larger category of contravariant functors to $\Sets$) we can always assume that we work in a category with fiber products.

Thanks to Yoneda lemma, we know that we can think a scheme as a contravariant functor from schemes to sets. This seems a bit circular, so we try to replace this with some precedent object. In particular, we assume to know affine schemes and we consider for a generic scheme $X$ the restriction of $\ho_X$ to affine schemes: \[ \ho_X\colon \AffineSchemes^{\opp} â†’ \Sets\text{.} \]

\begin{remark}
  As in Yoneda lemma, we get functors \[ \Schemes â†’ \Fun(\AffineSchemes^{\opp} â†’ \Sets)\text{,}\] but this could be no longer an equivalence.
\end{remark}

\begin{theorem}\label{theorem:affine schemes are enough}
  \mbox{}
  \begin{enumerate}
    \item This functor is a fully faithful;
    \item we can characterize its essential image, that is, we can describe which functors are isomorphic to $\ho_X$ for some scheme $X$, without using the definition of schemes.
  \end{enumerate}
\end{theorem}

\begin{corollary}
  Schemes forms a full subcategory of $\Fun(\AffineSchemes^\opp, \Sets)$.
\end{corollary}

So we can define scheme in a complete different way from the usual one, assuming only the knowledge of affine schemes (or equivalently finitely generated $K$-algebras). A way to understand this, is to think that a functor $\AffineSchemes^\opp â†’ \Sets$ encodes all possible charts from some affine schemes to our yet to be defined scheme, instead of just selecting some of them as we do in the usual way.

\begin{proof}[Proof of Theorem~\ref{theorem:affine schemes are enough}, part 1]
  Let $X$ and $Y$ be schemes so that $\ho_X, \ho_Y\colon \AffineSchemes^{\opp} â†’ \Sets$. We have to prove that $\Mor(X, Y) â†’ \Mor(\ho_X, \ho_Y)$ is a bijection; to do so we provide an inverse.
  
  Assume $X$ is separated; in particular, for every $U, V âŠ† X$ open affine, also $Uâˆ©V$ is open and affine; choose an open affine cover $\{U_i\mid i âˆˆ I\}$ of $X$ via inclusions $Î±_i\colon U_i â†’ X$. Let $f\colon \ho_X â†’ \ho_Y$; then $f(Î±_i) âˆˆ \ho_Y(U_i)$, that is $f(Î±_i)\colon U_i â†’ Y$. As usual define $U_{i,j} â‰” U_i âˆ© U_j$, with injections $s_{i,j}\colon U_{i,j} â†’ U_i$ and $t_{i,j}\colon U_{i,j} â†’ U_j$. Then 
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_1) at (1*\x, 0*\y) {$U_i$};
    \node (A1_0) at (0*\x, 1*\y) {$U_{i,j}$};
    \node (A1_2) at (2*\x, 1*\y) {$X$};
    \node (A2_1) at (1*\x, 2*\y) {$U_j$};
    \path (A1_0) edge [->] node [auto] {$\scriptstyle{Î±_{i,j}}$} (A1_2);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{t_{i,j}}$} (A2_1);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{Î±_i}$} (A1_2);
    \path (A2_1) edge [->] node [auto,swap] {$\scriptstyle{Î±_j}$} (A1_2);
    \path (A1_0) edge [->] node [auto] {$\scriptstyle{s_{i,j}}$} (A0_1);
  \end{tikzpicture}
  \]
  commutes and we get maps $s_{i,j}^â‹†\colon \ho_X(U_i) â†’ \ho_X(U_{i,j})$ and $t_{i,j}^â‹†\colon \ho_X(U_j) â†’ \ho_X(U_{i,j})$ that, applying $f$, we have \[ {f(Î±_i)}_{|U_{i,j}} = f(Î±_i) âˆ˜ s_{i,j}^â‹† = f(Î±_{i,j}) = f_(Î±_j) âˆ˜ t_{i,j}^â‹† = {f(Î±_j)}_{|U_{i,j}}\text{.}\] Therefore we can define $g\colon X â†’ Y$ in such a way that $g_{|U_i} = f(Î±_i)$ and $g$ is a uniquely determined morphism of schemes. It is now easy to check that this is really the inverse.
  
  In the nonseparated case, the argument is the same but we have to cover again the intersections $U_{i,j}$ by affine open sets and the proof is just notationally more complicated.âˆŽ
\end{proof}

Then taking either all schemes or only affine schemes, we get two equivalent categories $\Fun(\Schemes^{\opp}, \Sets)$ and $\Fun(\AffineSchemes^{\opp}, \Sets)$. To prove the second part of Theorem~\ref{theorem:affine schemes are enough}, we need a criterion which tell us when a functor is in the essential image of $\ho$. The key concept is the next proposition, which will be proved later.

\begin{proposition}
  Let $X$ be a scheme; then the functor $\ho_X$ is a sheaf in the Zariski topology on $\AffineSchemes$ in the following sense: if $S$ is an affine schemes and $\{U_i \mid i âˆˆ I\}$ is an affine open cover of $S$ (in particular, $U_{i,j}$ are also open affine), then the sequence
  \[
  \begin{tikzpicture}
    \def\x{2.8}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$\pha$};
    \node (A0_1) at (1*\x, 0*\y) {$\ho_X(S)$};
    \node (A0_2) at (2*\x, 0*\y) {$âˆ \ho_X(U_i)$};
    \node (A0_3) at (3*\x, 0*\y) {$âˆ \ho_X(U_{i,j})$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{}$} (A0_1);
    \path (A0_2) edge [->,bend left=10] node [auto] {$\scriptstyle{\ho_X(s_{i,j})}$} (A0_3);
    \path (A0_2) edge [->,bend right=10] node [auto,swap] {$\scriptstyle{\ho_X(t_{i,j})}$} (A0_3);
    \path (A0_1) edge [->] node [auto] {$\scriptstyle{\ho_X(Î±_i)}$} (A0_2);
  \end{tikzpicture}
  \]
  is exact. This means that $\ho_X(Î±_i)$ is injective and its image is the locus where the two other maps coincide. In other words, given for every $iâˆˆI$ morphisms $f_i âˆˆ \ho_X(U_i)$, then exists $f âˆˆ \ho_X(S)$ such that $f_{|U_i} = f_i$ (or $\ho_X(Î±_i)(f) = f_i$) if and only if ${f_i}_{|U_{i,j}} = {f_j}_{|U_{i,j}}$ (or $\ho_X(s_{i,j})(f_i) = \ho_X(t_{i,j})(f_j)$); if so, then $f$ is unique.
\end{proposition}

Another important and more difficult theorem is that $\ho_X$ is a sheaf also in the Ã©tale topology.

So far we have shown that the category of schemes is equivant to a full subcategory of the category of sheaves of sets on $\AffineSchemes$ for the Zariski (and we said it is true also for Ã©tale) topology. In particular we found what we were searching: now it is evident that morphisms of schemes forms a set, since the sheaves are of sets. How do we define sheaves of groupoids? The notion of presheaf of sets is just the one of contravariant functor to $\Sets$; then a presheaf of groupoids is just a contravariant functor to $\Groupoids$, adapted to the fact that groupoids form a $2$-category. After that we have to add glueing conditions to make a sheaf, but we will see these later.

One could ask if this is the best path to define stacks. Couldn't there be a definition that starts from a topological spaces like the objects we are acquainted to? Sure it is possible to associate a topological space to every stack; in particular orbifolds (that are, complex or symplectic manifolds that are equivalent to Deligne-Mumford stacks) are defined starting from a topological space. Indeed the definition of orbifold is much easier but it has an important problem.

\begin{problem}
  With the orbifold approach, the objects are very easy to define, the morphisms are messy and the $2$-morphisms are yet not defined.
\end{problem}

So let's go back to our path to the definition of presheaves of groupoids.

\begin{definition}
  Let $â„­$ be a category; a \emph{pseudofunctor\/} from $â„­$ to $\Groupoids$ is denoted as $F\colon â„­ â†’ \Groupoids$ and is the data of:
  \begin{itemize}
    \item for every $X âˆˆ \Obj(â„­)$, a groupoid $F(X)$;
    \item for every $f\colon X â†’ Y$, a functor $F(f)\colon F(Y) â†’ F(X)$.
    \item for every sequence $X \xra{f} Y \xra{g} Z$, a $2$-commutative diagram
  \[
  \begin{tikzpicture}
    \def\x{1.2}
    \def\y{-1.2}
    \node (A0_0) at (150:\x) {$F(X)$};
    \node (A0_2) at (30:\x) {$F(Z)$};
    \node (A1_1) at (270:\x) {$F(Y)$};
    \path (A1_1) edge [->] node [auto] {$\scriptstyle{F(f)}$} (A0_0);
    \path (A0_2) edge [->] node [auto] {$\scriptstyle{F(g)}$} (A1_1);
    \path (A0_2) edge [->] node [auto,swap] {$\scriptstyle{F(gâˆ˜f)}$} (A0_0);
    \path (273:\x) -- (80:0.9*\x) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.63,auto,sloped] {$\scriptstyle{Î±_{f,g}}$};
  \end{tikzpicture}
  \]
  \end{itemize}
  The data is subject to these conditions:
  \begin{itemize}
    \item $F(\id_X) = \id_{F(X)}$;
    \item when either $f$ or $g$ is the identity, then $Î±_{f,g}$ is the identity;
    \item for every sequence $X \xra{f} Y \xra{g} Z \xra{h} W$, a $2$-commutative tetrahedron (seen from above and from the bottom)
  \begin{align*}
  &\begin{tikzpicture}[baseline]
    \def\x{2}
    \def\y{-1.2}
    \node (A0_0) at (150:\x) {$F(X)$};
    \node (A0_2) at (30:\x) {$F(Z)$};
    \node (A1_1) at (0:0) {$F(W)$};
    \node (A2_1) at (270:\x) {$F(Y)$};
    \path (A1_1) edge [->] node [auto,very near start] {$\scriptstyle{F(hâˆ˜gâˆ˜f)}$} (A0_0);
    \path (A1_1) edge [->] node [auto,near end] {$\scriptstyle{F(h)}$} (A0_2);
    \path (A0_2) edge [->,bend right=45] node [auto,swap] {$\scriptstyle{F(gâˆ˜f)}$} (A0_0);
    \path (A0_2) edge [->,bend left=45] node [auto] {$\scriptstyle{F(g)}$} (A2_1);
    \path (A1_1) edge [->] node [auto,near end] {$\scriptstyle{F(hâˆ˜g)}$} (A2_1);
    \path (A2_1) edge [->,bend left=45] node [auto] {$\scriptstyle{F(f)}$} (A0_0);
    \path (A0_2) -- (A0_0) 
      node [pos=0.6,allow upside down,sloped] {$\Longrightarrow$}
      node [pos=0.6,auto,sloped] {$\scriptstyle{Î±_{gâˆ˜f,h}}$};
    \path (A2_1) -- (A0_0) 
      node [pos=0.35,allow upside down,sloped] {$\Longrightarrow$}
      node [pos=0.2,auto,sloped] {$\scriptstyle{Î±_{f,hâˆ˜g}}$};
    \path (A0_2) -- (A2_1) 
      node [pos=0.4,allow upside down,sloped] {$\Longrightarrow$}
      node [pos=0.5,auto,sloped] {$\scriptstyle{Î±_{h,g}}$};
  \end{tikzpicture}
  &&\begin{tikzpicture}[baseline]
    \def\x{2}
    \def\y{-1.2}
    \node (A0_0) at (150:\x) {$F(Z)$};
    \node (A0_2) at (30:\x) {$F(X)$};
    \node (A2_1) at (270:\x) {$F(Y)$};
    \path (A0_0) edge [->,bend left=45] node [auto] {$\scriptstyle{F(gâˆ˜f)}$} (A0_2);
    \path (A2_1) edge [->,bend right=45] node [auto,swap] {$\scriptstyle{F(f)}$} (A0_2);
    \path (A0_0) edge [->,bend right=45] node [auto,swap] {$\scriptstyle{F(g)}$} (A2_1);
    \path (273:\x) -- (80:0.9*\x) 
      node [pos=0.5,sloped] {$\Longrightarrow$}
      node [pos=0.53,auto,sloped] {$\scriptstyle{Î±_{f,g}}$};
  \end{tikzpicture}
  \end{align*}
      and we ask that the two $2$-commutative diagrams commutes.
  \end{itemize}
\end{definition}

The definition is the natural extension of the one of functors, once changed equalities of functors to $2$-isomorphisms. Actually, the first two condition do not follow this convention, but one sees that keeping this equalities does not rule out an important part of functors.

We encounter this approach every time we mess with groupoids and $2$-category: we change equality to $2$-isomorphisms, and request compatibility on the superior level. If for functors the data are something for every object and every arrow, subject to a condition on a sequence of two arrows, for pseudofunctors the data are something for every object, every arrow and every sequence of two arrows, subject to a condition for every sequence of three arrows.

\begin{example}
  Consider the mapping $V\colon \Manifolds â†’ \Groupoids$ where:
  \begin{itemize}
    \item $V(M)$ is the groupoids with objects rank $r$ vector bundles on $M$ and morphisms are isomorphisms of vector bundles;
    \item for every $f\colon M â†’ N$, a $â„­^âˆž$ map that associated to a rank $r$ vector bundle $E â†’ N$ the bundle $f^â‹† E â†’ M$ where $f^â‹† E â‰” M Ã—_N E$;
    \item for a sequence $P \xra{g} M \xra{f} N$, a $2$-morphism $Î±_{f,g}$ defined by the canonical isomorphisms $Î±_{f,g}(E)\colon g^â‹† f^â‹† E â†’ {(fâˆ˜g)}^â‹† E$.\TODO{}
%    \item for a morphism
%  \[
%  \begin{tikzpicture}
%    \def\x{1}
%    \def\y{-1.2}
%    \node (A0_0) at (150:\x) {$E$};
%    \node (A0_2) at (30:\x) {$Eâ€²$};
%    \node (A1_1) at (270:\x) {$N$};
%    \path (A0_0) edge [->] node [auto,swap] {$\scriptstyle{Ï€}$} (A1_1);
%    \path (A0_2) edge [->] node [auto] {$\scriptstyle{Ï€â€²}$} (A1_1);
%    \path (A0_0) edge [->] node [auto] {$\scriptstyle{g}$} node [rotate=180,sloped] {$\scriptstyle{\widetilde{\ \ \ }}$} (A0_2);
%  \end{tikzpicture}
%  \]
  \end{itemize} 
  Notice that already does not hold anymore $V(\id_E) = \id_{V(E)}$. Indeed, $\id^â‹† E$ inside $E Ã— N$ is the graph of $Ï€\colon E â†’ N$. In the same way, given $M_1 \xra{f} M_2 \xra{g} M_3$ and $Ï€\colon E â†’ N$, then $(gâˆ˜f)^â‹† E âŠ† M_1 Ã— E$ but $f^â‹† g^â‹† E âŠ† M_1 Ã— M_2 Ã— E$: they are different, altough canonically isomorphic as requested. Notice also that we never used the fact that $E â†’ N$ is a vector bundle: e.g. we could have done the same procedure with submersion of scheme of relative dimension $d$ there $Ï€$ is smooth, or proper, or projective.
\end{example}

\begin{remark}
  Recall we defined maps $Ï€_0\colon \Groupoids â†’ \Sets$ and $\Sets â†’ \Groupoids$ that considers a set as a groupoids with no nontrivial isomorphisms. There are associated maps \[ \PsFun(â„­^\opp, \Groupoids) \leftrightarrow \Fun(â„­^\opp, \Sets)\text{.} \]
\end{remark}

\begin{proof}
  If $F$ is a pseudofunctor, then we define $Ï€_0(F)(X) â‰” Ï€_0(F(X))$ and $Ï€_0(F)(f) â‰” Ï€_0(f)$ and this is a functor $â„­^\opp â†’ \Sets$, since via the $2$-morphisms $Î±(f,g)$, all that should be equal in the right side is isomorphic in the left side, so is equal once cramped by $Ï€_0$.
  
  Conversely, given $F\colon â„­^\opp â†’ \Sets$, we can extend it to a pseudofunctor $F\colon â„­^\opp â†’ \Groupoids$: this is a very particular pseudofunctor since all $2$-morphisms are identities.âˆŽ
\end{proof}

\begin{corollary}
  We can associate to every scheme a pseudofunctors \[ \AffineSchemes^\opp â†’ \Groupoids\text{.}\]
\end{corollary}

So far we have defined pseudofunctor and associate a pseudofunctor to a scheme as before we associate a functor to a scheme. Before we could see all the category $\Schemes$ as a full subcategory of the category of functors, so now we have to define the category of pseudofunctors, that will be actually a $2$-category.

\begin{definition}
  If $F, G$ are pseudofunctors, a \emph{morphism of pseudofunctor\/} $a\colon F â†’ G$ will be:
  \begin{itemize}
    \item for every $X âˆˆ \Obj(â„­)$, a functor $a_X\colon F(X) â†’ G(X)$;
    \item for every $f\colon X â†’ Y$ a $2$-commuting diagram
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A0_0) at (0*\x, 0*\y) {$F(X)$};
    \node (A0_1) at (1*\x, 0*\y) {$G(X)$};
    \node (A1_0) at (0*\x, 1*\y) {$F(Y)$};
    \node (A1_1) at (1*\x, 1*\y) {$G(Y)$};
    \path (A0_0) edge [->] node [auto] {$\scriptstyle{a_X}$} (A0_1);
    \path (A1_0) edge [->] node [auto,swap] {$\scriptstyle{a_Y}$} (A1_1);
    \path (A1_0) edge [->] node [auto] {$\scriptstyle{F(f)}$} (A0_0);
    \path (A1_1) edge [->] node [auto,swap] {$\scriptstyle{G(f)}$} (A0_1);
    \path (A0_0) -- (A1_1) 
      node [pos=0.5,sloped] {$\Longrightarrow$};
  \end{tikzpicture}
  \]
      such that
  \[
  \begin{tikzpicture}
    \def\x{1.5}
    \def\y{-1.2}
    \node (A1_0) at (0.3*\x, 1*\y) {$F(X)$};
    \node (A1_2) at (2.3*\x, 1*\y) {$G(X)$};
    \node (A2_1) at (1.3*\x, 2*\y) {$F(Y)$};
    \node (A2_3) at (3.3*\x, 2*\y) {$G(Y)$};
    \node (A3_0) at (0*\x, 3*\y) {$F(Z)$};
    \node (A3_2) at (2*\x, 3*\y) {$G(Z)$};
    \path (A3_0) edge [->] node [auto] {$\scriptstyle{}$} (A2_1);
    \path (A3_0) edge [->] node [auto] {$\scriptstyle{}$} (A3_2);
    \path (A1_0) edge [->] node [auto] {$\scriptstyle{}$} (A1_2);
    \path (A3_2) edge [->] node [auto] {$\scriptstyle{}$} (A2_3);
    \path (A2_3) edge [->] node [auto] {$\scriptstyle{}$} (A1_2);
    \path (A3_2) edge [->] node [auto] {$\scriptstyle{}$} (A1_2);
    \path (A2_1) edge [->] node [auto] {$\scriptstyle{}$} (A1_0);
    \path (A2_1) edge [->] node [auto] {$\scriptstyle{}$} (A2_3);
    \path (A3_0) edge [->] node [auto] {$\scriptstyle{}$} (A1_0);
  \end{tikzpicture}
  \]
      is $2$-commutative, where the $2$-morphism on the triangular faces are the ones defined by the pseudofunctors $F$ and $G$, while the $2$-morphisms on the rectangular faces are the one defined before.
  \end{itemize}
\end{definition}

\begin{definition}
  Given $a, b\colon F â†’ G$ where $F$ and $G$ are pseudofunctors, then a \emph{$2$-morphism of pseudofunctors\/} between $a$ and $b$ is denoted by $Î±\colon a â‡’ b$ and is the datum of:
  \begin{itemize}
    \item for every $X âˆˆ \Obj(â„­)$, a $2$-morphism $Î±_X\colon a_X â‡’ b_X$ such that  for every $f\colon X â†’ Y$, the diagram
  \[
  \begin{tikzpicture}
    \def\x{2}
    \def\y{-2}
    \node (A0_0) at (0*\x, 0*\y) {$F(X)$};
    \node (A0_1) at (1*\x, 0*\y) {$G(X)$};
    \node (A1_0) at (0*\x, 1*\y) {$F(Y)$};
    \node (A1_1) at (1*\x, 1*\y) {$G(Y)$};
    \path (A0_0) edge [->,bend left=20] node [auto] {$\scriptstyle{a_X}$} (A0_1);
    \path (A0_0) edge [->,bend right=20] node [auto,swap] {$\scriptstyle{b_X}$} (A0_1);
    \path (A1_0) edge [->,bend left=20] node [auto] {$\scriptstyle{a_Y}$} (A1_1);
    \path (A1_0) edge [->,bend right=20] node [auto,swap] {$\scriptstyle{b_Y}$} (A1_1);
    \path (A1_0) edge [->] node [auto] {$\scriptstyle{F(f)}$} (A0_0);
    \path (A1_1) edge [->] node [auto,swap] {$\scriptstyle{G(f)}$} (A0_1);
  \end{tikzpicture}
  \]
      is a $2$-commutative cylinder.
  \end{itemize}
\end{definition}

\nocite{*}
\bibliographystyle{amsalpha}
\bibliography{2009.01.12.Barbara.Fantechi.Algebraic.Stacks}


\end{document}
